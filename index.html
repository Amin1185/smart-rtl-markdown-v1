<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Markdown Previewer</title>
    <meta name="description" content="Smart RTL-aware Markdown previewer with MathJax, Prism, and Tailwind-like styles.">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    
    <!-- Marked.js for Markdown -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <!-- Prism.js for Syntax Highlighting -->
    <link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    
    <!-- MathJax for LaTeX with Persian/Arabic support -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$']],
                displayMath: [['$$', '$$']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
            },
            chtml: {
                mtextInheritFont: true,
                scale: 1
            },
            svg: {
                mtextInheritFont: true,
                scale: 1
            },
            startup: {
                ready: () => {
                    MathJax.startup.defaultReady();
                    window.mathJaxReady = true;
                }
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #a855f7 100%);
            --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            --card-shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
            --border-radius: 16px;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Vazirmatn', sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            min-height: 100vh;
        }

        /* Header gradient animation */
        .header-gradient {
            background: var(--primary-gradient);
            background-size: 200% 200%;
            animation: gradientShift 8s ease infinite;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        /* Glass morphism effect */
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: var(--card-shadow-lg);
            border-radius: var(--border-radius);
        }

        /* Editor styling */
        .editor-textarea {
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            line-height: 1.7;
            resize: none;
            background: #1e1e2e;
            color: #cdd6f4;
            border: none;
            transition: all 0.3s ease;
        }

        .editor-textarea::placeholder {
            color: #6c7086;
        }

        .editor-textarea:focus {
            outline: none;
            box-shadow: inset 0 0 0 2px rgba(99, 102, 241, 0.5);
        }

        /* Preview container with overflow handling */
        .preview-container {
            overflow-x: auto;
            overflow-y: auto;
        }

        /* Markdown output styling */
        .markdown-body {
            font-family: 'Vazirmatn', 'Inter', sans-serif;
            line-height: 1.8;
            color: #333;
        }

        /* Per-block direction styles */
        .markdown-body [dir="rtl"] {
            direction: rtl;
            text-align: right;
        }

        .markdown-body [dir="ltr"] {
            direction: ltr;
            text-align: left;
        }

        /* RTL list adjustments */
        .markdown-body ul[dir="rtl"], 
        .markdown-body ol[dir="rtl"] {
            padding-left: 0;
            padding-right: 2em;
        }

        .markdown-body ul[dir="ltr"], 
        .markdown-body ol[dir="ltr"] {
            padding-left: 2em;
            padding-right: 0;
        }

        /* Blockquote RTL/LTR adjustments */
        .markdown-body blockquote[dir="rtl"] {
            border-left: none;
            border-right: 4px solid #ddd;
            padding-right: 1em;
            padding-left: 0;
        }

        .markdown-body blockquote[dir="ltr"] {
            border-right: none;
            border-left: 4px solid #ddd;
            padding-left: 1em;
            padding-right: 0;
        }

        /* Plain headings */
        .markdown-body h1 {
            font-size: 2em;
            font-weight: 700;
            margin: 0.67em 0;
            color: #1a1a1a;
        }

        .markdown-body h2 {
            font-size: 1.5em;
            font-weight: 600;
            margin: 0.83em 0;
            color: #333;
        }

        .markdown-body h3 {
            font-size: 1.25em;
            font-weight: 600;
            margin: 1em 0;
            color: #444;
        }

        .markdown-body h4 {
            font-size: 1.1em;
            font-weight: 600;
            margin: 1em 0;
            color: #555;
        }

        .markdown-body p {
            margin-bottom: 1em;
            color: #444;
            overflow-wrap: break-word;
            word-wrap: break-word;
        }

        .markdown-body strong {
            font-weight: 700;
            color: #1a1a1a;
        }

        .markdown-body em {
            font-style: italic;
        }

        /* Plain bullet points */
        .markdown-body ul, .markdown-body ol {
            margin-bottom: 1em;
            padding-left: 2em;
        }

        .markdown-body ul {
            list-style-type: disc;
        }

        .markdown-body ol {
            list-style-type: decimal;
        }

        .markdown-body li {
            margin-bottom: 0.25em;
            color: #444;
        }

        .markdown-body a {
            color: #0066cc;
            text-decoration: underline;
        }

        .markdown-body a:hover {
            color: #004499;
        }

        /* Inline code with proper RTL isolation */
        .markdown-body code:not([class*="language-"]) {
            background: #f4f4f4;
            padding: 0.2em 0.4em;
            border-radius: 3px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9em;
            color: #333;
            border: 1px solid #ddd;
            unicode-bidi: isolate;
            direction: ltr;
            display: inline-block;
            vertical-align: baseline;
            white-space: nowrap;
        }

        /* Code blocks with horizontal scroll */
        .markdown-body pre {
            margin: 1em 0;
            border-radius: 8px;
            overflow-x: auto;
            overflow-y: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            direction: ltr !important;
            text-align: left !important;
            max-width: 100%;
        }

        .markdown-body pre code {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9em;
            line-height: 1.6;
            display: block;
            min-width: max-content;
            unicode-bidi: normal;
            white-space: pre;
        }

        .markdown-body blockquote {
            margin: 1em 0;
            padding: 0.5em 1em;
            background: #f9f9f9;
            border-left: 4px solid #ddd;
            color: #666;
            font-style: italic;
            overflow-x: auto;
        }

        .markdown-body hr {
            border: none;
            height: 1px;
            background: #ddd;
            margin: 2em 0;
        }

        /* Tables with horizontal scroll wrapper */
        .markdown-body .table-wrapper {
            overflow-x: auto;
            margin: 1em 0;
        }

        .markdown-body table {
            width: 100%;
            min-width: 400px;
            border-collapse: collapse;
            overflow: hidden;
        }

        .markdown-body th, .markdown-body td {
            padding: 0.5em 1em;
            border: 1px solid #ddd;
            text-align: left;
        }

        .markdown-body th {
            background: #f5f5f5;
            font-weight: 600;
            color: #333;
        }

        .markdown-body td {
            background: white;
        }

        /* Inline MathJax - NO scrollbars, proper alignment */
        mjx-container:not([display="true"]) {
            display: inline-block !important;
            overflow: visible !important;
            vertical-align: middle !important;
            margin: 0 2px !important;
            padding: 0 !important;
            max-width: none !important;
        }

        /* Block/display math styling */
        mjx-container[display="true"] {
            display: block !important;
            margin: 1em auto !important;
            padding: 1em;
            background: #fffbeb;
            border-radius: 8px;
            border: 1px solid #fde68a;
            text-align: center !important;
            direction: ltr !important;
            overflow-x: auto;
            overflow-y: hidden;
            max-width: 100%;
        }

        /* Fix for Persian/Arabic text in MathJax */
        mjx-mtext {
            font-family: 'Vazirmatn', 'Inter', sans-serif !important;
        }

        /* Footnotes styling */
        .markdown-body .footnotes {
            margin-top: 2em;
            padding-top: 1em;
            border-top: 1px solid #ddd;
            font-size: 0.9em;
            color: #666;
        }

        .markdown-body .footnotes ol {
            padding-left: 1.5em;
        }

        .markdown-body .footnotes li {
            margin-bottom: 0.5em;
        }

        .markdown-body .footnotes li p {
            display: inline;
            margin: 0;
        }

        .markdown-body .footnote-ref {
            font-size: 0.75em;
            vertical-align: super;
            line-height: 0;
        }

        .markdown-body .footnote-ref a {
            text-decoration: none;
            color: #6366f1;
            padding: 0 2px;
        }

        .markdown-body .footnote-ref a:hover {
            text-decoration: underline;
        }

        .markdown-body .footnote-backref {
            text-decoration: none;
            margin-left: 0.5em;
        }

        /* BDI elements for isolated Latin text in RTL */
        .markdown-body bdi {
            unicode-bidi: isolate;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #94a3b8 0%, #64748b 100%);
            border-radius: 5px;
            border: 2px solid #f1f5f9;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #64748b 0%, #475569 100%);
        }

        /* Scrollbar for dark elements */
        .editor-textarea::-webkit-scrollbar-track,
        pre::-webkit-scrollbar-track {
            background: #313244;
        }

        .editor-textarea::-webkit-scrollbar-thumb,
        pre::-webkit-scrollbar-thumb {
            background: #585b70;
            border: 2px solid #313244;
        }

        /* Window controls */
        .window-controls {
            display: flex;
            gap: 8px;
            padding: 12px 16px;
            background: #1e1e2e;
            border-bottom: 1px solid #313244;
        }

        .window-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            transition: transform 0.2s ease;
        }

        .window-dot:hover {
            transform: scale(1.2);
        }

        .window-dot.red { background: #f38ba8; }
        .window-dot.yellow { background: #f9e2af; }
        .window-dot.green { background: #a6e3a1; }

        /* Direction indicator */
        .direction-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
        }

        .direction-badge.mixed {
            background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%);
            color: #4338ca;
        }

        .direction-badge.rtl {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            color: #92400e;
        }

        .direction-badge.ltr {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            color: #1e40af;
        }

        /* Stats bar */
        .stats-bar {
            display: flex;
            gap: 16px;
            font-size: 12px;
            color: #64748b;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* Pulse animation for live indicator */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .live-indicator {
            animation: pulse 2s ease-in-out infinite;
        }

        /* Direction stats */
        .direction-stats {
            display: flex;
            gap: 8px;
            font-size: 11px;
        }

        .direction-stats span {
            padding: 2px 8px;
            border-radius: 10px;
            background: #f1f5f9;
        }

        .direction-stats .rtl-count {
            background: #fef3c7;
            color: #92400e;
        }

        .direction-stats .ltr-count {
            background: #dbeafe;
            color: #1e40af;
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Header -->
    <header class="header-gradient text-white py-8 shadow-2xl relative overflow-hidden">
        <div class="absolute inset-0 bg-[url('data:image/svg+xml,%3Csvg width=\"60\" height=\"60\" viewBox=\"0 0 60 60\" xmlns=\"http://www.w3.org/2000/svg\"%3E%3Cg fill=\"none\" fill-rule=\"evenodd\"%3E%3Cg fill=\"%23ffffff\" fill-opacity=\"0.05\"%3E%3Cpath d=\"M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z\"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E')] opacity-50"></div>
        <div class="container mx-auto px-6 relative z-10">
            <div class="flex items-center justify-center gap-4">
                <div class="p-3 bg-white/20 rounded-2xl backdrop-blur-sm">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                    </svg>
                </div>
                <div class="text-center">
                    <h1 class="text-3xl md:text-4xl font-bold tracking-tight">Advanced Markdown Previewer</h1>
                    <p class="text-indigo-100 mt-2 text-lg">Real-time preview with MathJax, Syntax Highlighting & Smart Per-Block RTL</p>
                </div>
            </div>
            
            <!-- Feature badges -->
            <div class="flex flex-wrap justify-center gap-3 mt-6">
                <span class="px-3 py-1 bg-white/20 rounded-full text-sm backdrop-blur-sm">üìù Markdown</span>
                <span class="px-3 py-1 bg-white/20 rounded-full text-sm backdrop-blur-sm">üî¢ MathJax</span>
                <span class="px-3 py-1 bg-white/20 rounded-full text-sm backdrop-blur-sm">üé® Syntax Highlight</span>
                <span class="px-3 py-1 bg-white/20 rounded-full text-sm backdrop-blur-sm">üîÑ Per-Block RTL/LTR</span>
                <span class="px-3 py-1 bg-white/20 rounded-full text-sm backdrop-blur-sm">üìå Footnotes</span>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-10">
        <div class="grid grid-cols-1 xl:grid-cols-2 gap-8">
            <!-- Editor Panel -->
            <div class="flex flex-col">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center gap-3">
                        <div class="w-3 h-3 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500"></div>
                        <h2 class="text-lg font-semibold text-slate-700">Markdown Editor</h2>
                    </div>
                    <div class="stats-bar" id="stats">
                        <span class="stat-item">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            <span id="word-count">0 words</span>
                        </span>
                        <span class="stat-item">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                            </svg>
                            <span id="char-count">0 chars</span>
                        </span>
                    </div>
                </div>
                
                <div class="glass-card overflow-hidden flex-1 flex flex-col">
                    <div class="window-controls">
                        <div class="window-dot red"></div>
                        <div class="window-dot yellow"></div>
                        <div class="window-dot green"></div>
                        <span class="text-slate-400 text-sm ml-4 font-mono">document.md</span>
                        <div class="ml-auto flex items-center gap-2">
                            <span class="live-indicator flex items-center gap-1.5 text-emerald-400 text-xs font-medium">
                                <span class="w-2 h-2 bg-emerald-400 rounded-full"></span>
                                LIVE
                            </span>
                        </div>
                    </div>
                    <textarea 
                        id="markdown-input" 
                        class="editor-textarea w-full flex-1 p-5 min-h-[600px]"
                        placeholder="Start typing your Markdown here...

# Supports
- **Bold** and *italic* text
- Math: $E = mc^2$ or $$\int_0^\infty f(x)dx$$
- Code blocks with syntax highlighting
- Per-block RTL/LTR detection
- Footnotes[^1]

[^1]: This is a footnote!"
                        spellcheck="false"
                    ></textarea>
                </div>
            </div>

            <!-- Preview Panel -->
            <div class="flex flex-col">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center gap-3">
                        <div class="w-3 h-3 rounded-full bg-gradient-to-r from-emerald-500 to-teal-500"></div>
                        <h2 class="text-lg font-semibold text-slate-700">Live Preview</h2>
                    </div>
                    <div class="flex items-center gap-3">
                        <div class="direction-stats" id="direction-stats">
                            <span class="rtl-count">RTL: 0</span>
                            <span class="ltr-count">LTR: 0</span>
                        </div>
                        <div id="direction-indicator">
                            <span class="direction-badge ltr">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path>
                                </svg>
                                PER-BLOCK
                            </span>
                        </div>
                    </div>
                </div>
                
                <div class="glass-card overflow-hidden flex-1 flex flex-col">
                    <div class="flex items-center gap-2 px-4 py-3 bg-gradient-to-r from-slate-50 to-slate-100 border-b border-slate-200">
                        <div class="flex gap-1.5">
                            <div class="w-3 h-3 rounded-full bg-rose-400"></div>
                            <div class="w-3 h-3 rounded-full bg-amber-400"></div>
                            <div class="w-3 h-3 rounded-full bg-emerald-400"></div>
                        </div>
                        <span class="text-slate-500 text-sm ml-2 font-mono">preview.html</span>
                    </div>
                    <div 
                        id="markdown-output" 
                        class="markdown-body preview-container p-8 min-h-[600px] flex-1"
                    >
                        <p class="text-slate-400 text-center italic">Your preview will appear here...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Reference Cards -->
        <div class="mt-12 grid grid-cols-1 md:grid-cols-4 gap-6">
            <!-- Markdown Reference -->
            <div class="glass-card p-6">
                <h3 class="text-lg font-semibold text-slate-700 mb-4 flex items-center gap-2">
                    <span class="p-2 bg-indigo-100 rounded-lg">üìù</span>
                    Markdown Syntax
                </h3>
                <div class="space-y-3 text-sm">
                    <div class="flex justify-between items-center p-2 bg-slate-50 rounded-lg">
                        <code class="text-indigo-600 font-mono"># Heading</code>
                        <span class="text-slate-500">Header</span>
                    </div>
                    <div class="flex justify-between items-center p-2 bg-slate-50 rounded-lg">
                        <code class="text-indigo-600 font-mono">**bold**</code>
                        <span class="text-slate-500">Bold text</span>
                    </div>
                    <div class="flex justify-between items-center p-2 bg-slate-50 rounded-lg">
                        <code class="text-indigo-600 font-mono">*italic*</code>
                        <span class="text-slate-500">Italic text</span>
                    </div>
                    <div class="flex justify-between items-center p-2 bg-slate-50 rounded-lg">
                        <code class="text-indigo-600 font-mono">`code`</code>
                        <span class="text-slate-500">Inline code</span>
                    </div>
                </div>
            </div>

            <!-- Math Reference -->
            <div class="glass-card p-6">
                <h3 class="text-lg font-semibold text-slate-700 mb-4 flex items-center gap-2">
                    <span class="p-2 bg-purple-100 rounded-lg">üî¢</span>
                    Math (LaTeX)
                </h3>
                <div class="space-y-3 text-sm">
                    <div class="flex justify-between items-center p-2 bg-slate-50 rounded-lg">
                        <code class="text-purple-600 font-mono">$E=mc^2$</code>
                        <span class="text-slate-500">Inline</span>
                    </div>
                    <div class="flex justify-between items-center p-2 bg-slate-50 rounded-lg">
                        <code class="text-purple-600 font-mono">$$\sum_{i=1}^n$$</code>
                        <span class="text-slate-500">Block</span>
                    </div>
                    <div class="flex justify-between items-center p-2 bg-slate-50 rounded-lg">
                        <code class="text-purple-600 font-mono">\color{red}{x}</code>
                        <span class="text-slate-500">Colors</span>
                    </div>
                    <div class="flex justify-between items-center p-2 bg-slate-50 rounded-lg">
                        <code class="text-purple-600 font-mono">\text{ŸÅÿßÿ±ÿ≥€å}</code>
                        <span class="text-slate-500">Persian</span>
                    </div>
                </div>
            </div>

            <!-- Footnotes Reference -->
            <div class="glass-card p-6">
                <h3 class="text-lg font-semibold text-slate-700 mb-4 flex items-center gap-2">
                    <span class="p-2 bg-amber-100 rounded-lg">üìå</span>
                    Footnotes
                </h3>
                <div class="space-y-3 text-sm">
                    <div class="p-2 bg-slate-50 rounded-lg">
                        <code class="text-amber-600 font-mono block">Text[^1]</code>
                        <span class="text-slate-500 text-xs">Reference</span>
                    </div>
                    <div class="p-2 bg-slate-50 rounded-lg">
                        <code class="text-amber-600 font-mono block">[^1]: Note text</code>
                        <span class="text-slate-500 text-xs">Definition</span>
                    </div>
                    <p class="text-slate-500 text-xs mt-2">
                        Footnotes appear at the bottom of the preview.
                    </p>
                </div>
            </div>

            <!-- Code Reference -->
            <div class="glass-card p-6">
                <h3 class="text-lg font-semibold text-slate-700 mb-4 flex items-center gap-2">
                    <span class="p-2 bg-emerald-100 rounded-lg">üíª</span>
                    Code Blocks
                </h3>
                <div class="space-y-3 text-sm">
                    <div class="p-2 bg-slate-50 rounded-lg">
                        <code class="text-emerald-600 font-mono block">```javascript</code>
                        <code class="text-slate-500 font-mono block pl-2">// your code</code>
                        <code class="text-emerald-600 font-mono block">```</code>
                    </div>
                    <p class="text-slate-500 text-xs mt-2">
                        Supports: JavaScript, Python, TypeScript, CSS, HTML, JSON, Bash, and many more...
                    </p>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="text-center py-6 text-slate-500 text-sm border-t border-slate-200 bg-white/50">
        <p>Built with ‚ù§Ô∏è using Marked.js, MathJax, and Prism.js</p>
    </footer>

    <script>
        // Helper function to escape HTML
        function escapeHtml(text) {
            return text
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;');
        }

        // ============================================
        // FOOTNOTE EXTENSION FOR MARKED.JS
        // ============================================
        
        const footnoteStorage = {
            footnotes: {},
            footnoteRefs: [],
            reset() {
                this.footnotes = {};
                this.footnoteRefs = [];
            }
        };

        // Extension to handle footnote references [^1]
        const footnoteRefExtension = {
            name: 'footnoteRef',
            level: 'inline',
            start(src) {
                return src.match(/\[\^/)?.index;
            },
            tokenizer(src) {
                const match = /^\[\^([^\]]+)\](?!\:)/.exec(src);
                if (match) {
                    const id = match[1].trim();
                    if (!footnoteStorage.footnoteRefs.includes(id)) {
                        footnoteStorage.footnoteRefs.push(id);
                    }
                    return {
                        type: 'footnoteRef',
                        raw: match[0],
                        id: id,
                        refIndex: footnoteStorage.footnoteRefs.indexOf(id) + 1
                    };
                }
            },
            renderer(token) {
                return `<sup class="footnote-ref"><a href="#fn-${token.id}" id="fnref-${token.id}">[${token.refIndex}]</a></sup>`;
            }
        };

        // Extension to handle footnote definitions [^1]: text
        const footnoteDefExtension = {
            name: 'footnoteDef',
            level: 'block',
            start(src) {
                return src.match(/^\[\^[^\]]+\]:/)?.index;
            },
            tokenizer(src) {
                const match = /^\[\^([^\]]+)\]:\s*(.+?)(?:\n|$)/.exec(src);
                if (match) {
                    const id = match[1].trim();
                    const content = match[2].trim();
                    footnoteStorage.footnotes[id] = content;
                    return {
                        type: 'footnoteDef',
                        raw: match[0],
                        id: id,
                        content: content
                    };
                }
            },
            renderer(token) {
                return '';
            }
        };

        // Function to append footnotes section
        function appendFootnotesSection(html) {
            const ids = footnoteStorage.footnoteRefs;
            if (ids.length === 0) return html;
            
            let footnotesHtml = '<section class="footnotes"><ol>';
            ids.forEach((id, index) => {
                const content = footnoteStorage.footnotes[id] || 'Footnote not defined';
                const parsedContent = marked.parseInline(content);
                footnotesHtml += `<li id="fn-${id}"><p>${parsedContent} <a href="#fnref-${id}" class="footnote-backref">‚Ü©</a></p></li>`;
            });
            footnotesHtml += '</ol></section>';
            
            return html + footnotesHtml;
        }

        // Configure marked.js with custom renderer and footnote extensions
        marked.use({
            breaks: true,
            gfm: true,
            extensions: [footnoteRefExtension, footnoteDefExtension],
            renderer: {
                code({text, lang, escaped}) {
                    const langClass = lang ? escapeHtml(lang.split(/\s/)[0]) : 'plaintext';
                    let highlighted;
            
                    if (lang && Prism.languages[lang]) {
                        try {
                            highlighted = Prism.highlight(text, Prism.languages[lang], lang);
                        } catch (e) {
                            console.error(e);
                            highlighted = escaped ? text : escapeHtml(text);
                        }
                    } else {
                        highlighted = escaped ? text : escapeHtml(text);
                    }
            
                    return `<pre class="language-${langClass}"><code class="language-${langClass}">${highlighted}</code></pre>`;
                }
            }
        });

        // Wrap tables with scrollable container after parsing
        function wrapTables(html) {
            return html.replace(/<table>/g, '<div class="table-wrapper"><table>')
                       .replace(/<\/table>/g, '</table></div>');
        }
        
        // DOM elements
        const markdownInput = document.getElementById('markdown-input');
        const markdownOutput = document.getElementById('markdown-output');
        const directionIndicator = document.getElementById('direction-indicator');
        const directionStats = document.getElementById('direction-stats');
        const wordCountEl = document.getElementById('word-count');
        const charCountEl = document.getElementById('char-count');

        // Persian/Arabic Unicode ranges
        const PERSIAN_ARABIC_PATTERN = /[\u0600-\u06FF\u0750-\u077F\uFB50-\uFDFF\uFE70-\uFEFF]/g;
        // Latin characters pattern (including extended Latin)
        const LATIN_PATTERN = /[A-Za-z\u00C0-\u024F]/g;

        // Count Persian vs Latin characters in text
        function countCharacterTypes(text) {
            const cleanText = text
                .replace(/<[^>]*>/g, '')
                .replace(/\$\$[\s\S]*?\$\$/g, '')
                .replace(/\$[^$]+\$/g, '')
                .replace(/`[^`]+`/g, '')
                .replace(/```[\s\S]*?```/g, '')
                .replace(/https?:\/\/[^\s]+/g, '')
                .replace(/[0-9\s\p{P}\p{S}]/gu, '');
            
            const persianMatches = cleanText.match(PERSIAN_ARABIC_PATTERN) || [];
            const latinMatches = cleanText.match(LATIN_PATTERN) || [];
            
            return {
                persian: persianMatches.length,
                latin: latinMatches.length
            };
        }

        // Determine direction based on majority character type
        function getElementDirection(text) {
            const counts = countCharacterTypes(text);
            
            if (counts.persian === 0 && counts.latin === 0) {
                return 'ltr';
            }
            
            return counts.persian > counts.latin ? 'rtl' : 'ltr';
        }

        // Apply direction to each block element
        function applyPerBlockDirection(container) {
            let rtlCount = 0;
            let ltrCount = 0;
            
            const blockSelectors = [
                'p', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6',
                'li', 'blockquote', 'th', 'td'
            ];
            
            const lists = container.querySelectorAll('ul, ol');
            lists.forEach(list => {
                const listText = list.textContent || '';
                const direction = getElementDirection(listText);
                list.setAttribute('dir', direction);
                if (direction === 'rtl') rtlCount++; else ltrCount++;
            });
            
            blockSelectors.forEach(selector => {
                const elements = container.querySelectorAll(selector);
                elements.forEach(el => {
                    if (el.closest('pre') || el.closest('code')) {
                        return;
                    }
                    
                    const text = el.textContent || '';
                    const direction = getElementDirection(text);
                    
                    el.setAttribute('dir', direction);
                    
                    if (direction === 'rtl') {
                        rtlCount++;
                    } else {
                        ltrCount++;
                    }
                });
            });
            
            return { rtlCount, ltrCount };
        }

        // ============================================
        // BIDI TEXT ISOLATION - Fix for mixed RTL/LTR
        // ============================================
        
        // Isolate Latin character sequences within RTL elements using <bdi> tags
        // This must run AFTER MathJax has rendered to avoid breaking math
        function isolateLatinInRTL(container) {
            const rtlElements = container.querySelectorAll('[dir="rtl"]');
            
            rtlElements.forEach(el => {
                // Skip code elements
                if (el.tagName === 'PRE' || el.tagName === 'CODE') return;
                if (el.closest('pre') || el.closest('code')) return;
                
                // Collect all text nodes first (avoid modifying while iterating)
                const walker = document.createTreeWalker(el, NodeFilter.SHOW_TEXT);
                const textNodes = [];
                let currentNode;
                while (currentNode = walker.nextNode()) {
                    // Skip text inside code, pre, bdi, or MathJax elements
                    const parent = currentNode.parentElement;
                    if (parent && !parent.closest('code, pre, bdi, mjx-container, mjx-math, mjx-mrow, mjx-mi, mjx-mo, mjx-mn, mjx-mtext, mjx-msup, mjx-msub, mjx-mfrac, mjx-msqrt, mjx-mroot, mjx-mtable, mjx-mtr, mjx-mtd, script, style')) {
                        textNodes.push(currentNode);
                    }
                }
                
                // Process each text node
                textNodes.forEach(textNode => {
                    const text = textNode.textContent;
                    
                    // Match Latin letter sequences (including those with numbers)
                    const regex = /[^\s\u0600-\u06FF\u0750-\u077F\uFB50-\uFDFF\uFE70-\uFEFF]*[A-Za-z][^\s\u0600-\u06FF\u0750-\u077F\uFB50-\uFDFF\uFE70-\uFEFF]*(?:\s+[^\s\u0600-\u06FF\u0750-\u077F\uFB50-\uFDFF\uFE70-\uFEFF]*[A-Za-z][^\s\u0600-\u06FF\u0750-\u077F\uFB50-\uFDFF\uFE70-\uFEFF]*)*/g;
                    
                    if (!regex.test(text)) return;
                    regex.lastIndex = 0;
                    
                    const fragment = document.createDocumentFragment();
                    let lastIndex = 0;
                    let match;
                    let hasMatches = false;
                    
                    while ((match = regex.exec(text)) !== null) {
                        hasMatches = true;
                        
                        // Add text before the match
                        if (match.index > lastIndex) {
                            fragment.appendChild(document.createTextNode(text.slice(lastIndex, match.index)));
                        }
                        
                        let matchedText = match[0];
                        let trailingPunct = '';
                        
                        // Strip trailing sentence punctuation (should stay outside the isolated block)
                        const trailingMatch = matchedText.match(/[.!?,;:]+$/);
                        if (trailingMatch) {
                            trailingPunct = trailingMatch[0];
                            matchedText = matchedText.slice(0, -trailingPunct.length);
                        }
                        
                        // Wrap Latin sequence in <bdi> for isolation (if content remains)
                        if (matchedText) {
                            const bdi = document.createElement('bdi');
                            bdi.textContent = matchedText;
                            fragment.appendChild(bdi);
                        }
                        
                        // Add trailing punctuation outside the isolation
                        if (trailingPunct) {
                            fragment.appendChild(document.createTextNode(trailingPunct));
                        }
                        
                        lastIndex = regex.lastIndex;
                    }
                    
                    // Add remaining text after last match
                    if (lastIndex < text.length) {
                        fragment.appendChild(document.createTextNode(text.slice(lastIndex)));
                    }
                    
                    // Replace the text node with the fragment if we made changes
                    if (hasMatches && textNode.parentNode) {
                        textNode.parentNode.replaceChild(fragment, textNode);
                    }
                });
            });
        }

        // Update direction indicator UI
        function updateDirectionIndicator(rtlCount, ltrCount) {
            const total = rtlCount + ltrCount;
            let badgeClass, label, iconPath;
            
            if (total === 0) {
                badgeClass = 'ltr';
                label = 'LTR';
                iconPath = 'M14 5l7 7m0 0l-7 7m7-7H3';
            } else if (rtlCount > 0 && ltrCount > 0) {
                badgeClass = 'mixed';
                label = 'MIXED';
                iconPath = 'M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4';
            } else if (rtlCount > ltrCount) {
                badgeClass = 'rtl';
                label = 'RTL';
                iconPath = 'M10 19l-7-7m0 0l7-7m-7 7h18';
            } else {
                badgeClass = 'ltr';
                label = 'LTR';
                iconPath = 'M14 5l7 7m0 0l-7 7m7-7H3';
            }
            
            directionIndicator.innerHTML = `
                <span class="direction-badge ${badgeClass}">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${iconPath}"></path>
                    </svg>
                    ${label}
                </span>
            `;
            
            directionStats.innerHTML = `
                <span class="rtl-count">RTL: ${rtlCount}</span>
                <span class="ltr-count">LTR: ${ltrCount}</span>
            `;
        }

        // Update word and character count
        function updateStats(text) {
            const chars = text.length;
            const words = text.trim() ? text.trim().split(/\s+/).length : 0;
            wordCountEl.textContent = `${words} word${words !== 1 ? 's' : ''}`;
            charCountEl.textContent = `${chars} char${chars !== 1 ? 's' : ''}`;
        }

        // Escape math expressions before markdown parsing
        function escapeMath(text) {
            const mathBlocks = [];
            const inlineMaths = [];
            
            // Escape block math $$...$$ (including multiline)
            text = text.replace(/\$\$([\s\S]*?)\$\$/g, (match, math) => {
                mathBlocks.push(match);
                return `%%MATHBLOCK${mathBlocks.length - 1}%%`;
            });
            
            // Escape inline math $...$
            text = text.replace(/\$([^\$\n]+?)\$/g, (match, math) => {
                inlineMaths.push(match);
                return `%%MATHINLINE${inlineMaths.length - 1}%%`;
            });
            
            return { text, mathBlocks, inlineMaths };
        }

        // Restore math expressions after markdown parsing
        function restoreMath(html, mathBlocks, inlineMaths) {
            mathBlocks.forEach((math, i) => {
                html = html.replace(`%%MATHBLOCK${i}%%`, math);
            });
            
            inlineMaths.forEach((math, i) => {
                html = html.replace(`%%MATHINLINE${i}%%`, math);
            });
            
            return html;
        }

        // Main update function
        function updatePreview() {
            const rawMarkdown = markdownInput.value;
            
            updateStats(rawMarkdown);
            
            if (rawMarkdown.trim() === '') {
                markdownOutput.innerHTML = '<p class="text-slate-400 text-center italic">Your preview will appear here...</p>';
                updateDirectionIndicator(0, 0);
                return;
            }
            
            footnoteStorage.reset();
            
            const { text, mathBlocks, inlineMaths } = escapeMath(rawMarkdown);
            
            let html = marked.parse(text);
            
            html = restoreMath(html, mathBlocks, inlineMaths);
            
            html = wrapTables(html);
            
            html = appendFootnotesSection(html);
            
            markdownOutput.innerHTML = html;
            
            // Apply per-block direction
            const directionCounts = applyPerBlockDirection(markdownOutput);
            
            updateDirectionIndicator(directionCounts.rtlCount, directionCounts.ltrCount);
            
            Prism.highlightAllUnder(markdownOutput);
            
            // Process MathJax first, then apply bidi isolation
            if (window.MathJax && window.MathJax.typesetPromise) {
                MathJax.typesetClear([markdownOutput]);
                MathJax.typesetPromise([markdownOutput]).then(() => {
                    // Isolate Latin characters AFTER MathJax has rendered
                    isolateLatinInRTL(markdownOutput);
                }).catch((err) => {
                    console.error('MathJax error:', err);
                    // Still try to isolate Latin even if MathJax fails
                    isolateLatinInRTL(markdownOutput);
                });
            } else {
                // If MathJax not available, just isolate Latin
                isolateLatinInRTL(markdownOutput);
            }
        }

        // Debounce function for performance
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Event listeners
        const debouncedUpdate = debounce(updatePreview, 150);
        markdownInput.addEventListener('input', debouncedUpdate);
        markdownInput.addEventListener('paste', () => setTimeout(updatePreview, 0));

        // Sample content - More diverse examples
        const sampleMarkdown = `# üöÄ Advanced Markdown Previewer

Welcome to this **powerful** Markdown editor with *real-time preview*, LaTeX math support, syntax highlighting, and **smart per-block RTL detection**.

---

## üìê Mathematics Showcase

### Basic Equations

The famous mass-energy equivalence: $E = mc^2$

Euler's identity: $e^{i\\pi} + 1 = 0$

Quadratic formula: $x = \\frac{-b \\pm \\sqrt{b^2-4ac}}{2a}$

### Colorful Math

Colors in formulas: $\\color{red}{a^2} + \\color{blue}{b^2} = \\color{green}{c^2}$

Gradient-like: $\\color{purple}{\\nabla} \\cdot \\color{orange}{\\vec{E}} = \\frac{\\color{red}{\\rho}}{\\color{blue}{\\varepsilon_0}}$

### Block Equations

The Gaussian integral:

$$\\int_{-\\infty}^{\\infty} e^{-x^2} dx = \\sqrt{\\pi}$$

Maxwell's equations in differential form:

$$\\nabla \\times \\vec{E} = -\\frac{\\partial \\vec{B}}{\\partial t}$$

Schr√∂dinger equation:

$$i\\hbar\\frac{\\partial}{\\partial t}\\Psi = \\hat{H}\\Psi$$

### Matrix Example

$$\\begin{pmatrix} a & b \\\\ c & d \\end{pmatrix} \\begin{pmatrix} x \\\\ y \\end{pmatrix} = \\begin{pmatrix} ax + by \\\\ cx + dy \\end{pmatrix}$$

---

## üáÆüá∑ ÿ®ÿÆÿ¥ ŸÅÿßÿ±ÿ≥€å

### ÿ±€åÿßÿ∂€åÿßÿ™ ÿ®Ÿá ŸÅÿßÿ±ÿ≥€å

ŸÖÿπÿßÿØŸÑŸá ÿßŸÜ€åÿ¥ÿ™€åŸÜ $E = mc^2$ ŸÅ€åÿ≤€å⁄© ÿ±ÿß ŸÖÿ™ÿ≠ŸàŸÑ ⁄©ÿ±ÿØ.

ŸÅÿ±ŸÖŸàŸÑ ÿßŸÜÿ™⁄Øÿ±ÿßŸÑ ⁄ØÿßŸàÿ≥€å ÿ®Ÿá ÿµŸàÿ±ÿ™ ÿ≤€åÿ± ÿßÿ≥ÿ™:

$$\\int_{-\\infty}^{+\\infty} e^{-x^2} dx = \\sqrt{\\pi}$$

### ŸÖÿ™ŸÜ ŸÅÿßÿ±ÿ≥€å ÿ®ÿß ŸÅÿ±ŸÖŸàŸÑ ÿ±ŸÜ⁄Ø€å

ÿØÿ± ÿß€åŸÜ ŸÖÿπÿßÿØŸÑŸá $\\color{red}{x}$ ŸÖÿ¨ŸáŸàŸÑ Ÿà $\\color{blue}{a}$ Ÿà $\\color{green}{b}$ ÿ´ÿßÿ®ÿ™ Ÿáÿ≥ÿ™ŸÜÿØ.

### ŸÅÿ±ŸÖŸàŸÑ ÿ®ÿß ŸÖÿ™ŸÜ ŸÅÿßÿ±ÿ≥€å ÿØÿßÿÆŸÑ ÿ¢ŸÜ

ÿ®ÿ±ÿß€å ŸÜŸàÿ¥ÿ™ŸÜ ŸÅÿßÿ±ÿ≥€å ÿØÿ± ŸÅÿ±ŸÖŸàŸÑ ÿßÿ≤ ÿØÿ≥ÿ™Ÿàÿ± text ÿßÿ≥ÿ™ŸÅÿßÿØŸá ⁄©ŸÜ€åÿØ:

$$F = m \\cdot a \\quad \\text{(ŸÇÿßŸÜŸàŸÜ ÿØŸàŸÖ ŸÜ€åŸàÿ™ŸàŸÜ)}$$

$$E = \\frac{1}{2}mv^2 \\quad \\text{ÿßŸÜÿ±⁄ò€å ÿ¨ŸÜÿ®ÿ¥€å}$$

### ⁄©ÿØ ÿØÿ± ŸÖÿ™ŸÜ ŸÅÿßÿ±ÿ≥€å

ÿØÿ± ÿß€åŸÜ ÿÆÿ∑ ⁄ÜŸÜÿØ ⁄©ÿØ \`first\` Ÿà \`second\` Ÿà \`third\` Ÿàÿ¨ŸàÿØ ÿØÿßÿ±ÿØ.

ÿ®ÿ±ÿß€å ÿßÿ¨ÿ±ÿß€å ÿ®ÿ±ŸÜÿßŸÖŸá ÿßÿ≤ ÿØÿ≥ÿ™Ÿàÿ± \`npm start\` Ÿà €åÿß \`yarn dev\` ÿßÿ≥ÿ™ŸÅÿßÿØŸá ⁄©ŸÜ€åÿØ.

ÿ™Ÿàÿßÿ®ÿπ ŸÖŸáŸÖ ÿ¨ÿßŸàÿßÿßÿ≥⁄©ÿ±€åŸæÿ™: \`console.log()\` Ÿà \`document.getElementById()\` Ÿà \`addEventListener()\`

### ÿ™ÿ≥ÿ™ ÿ™ÿ±ÿ™€åÿ® ÿ≠ÿ±ŸàŸÅ ŸÑÿßÿ™€åŸÜ

ÿß€åŸÜ ÿ¥ÿßŸÖŸÑ ŸÖŸàÿßÿ±ÿØ Aÿå B Ÿà C ÿßÿ≥ÿ™.

⁄Øÿ≤€åŸÜŸá‚ÄåŸáÿß€å Xÿå Y Ÿà Z ÿ±ÿß ÿ®ÿ±ÿ±ÿ≥€å ⁄©ŸÜ€åÿØ.

---

## üíª Code Examples

### JavaScript - Async/Await

\`\`\`javascript
// Fetch data with async/await
async function fetchUserData(userId) {
    try {
        const response = await fetch(\`/api/users/\${userId}\`);
        if (!response.ok) throw new Error('User not found');
        
        const user = await response.json();
        console.log(\`Welcome, \${user.name}!\`);
        return user;
    } catch (error) {
        console.error('Failed to fetch user:', error.message);
        throw error;
    }
}

// Usage with Promise.all
const users = await Promise.all([
    fetchUserData(1),
    fetchUserData(2),
    fetchUserData(3)
]);
\`\`\`

### Python - Data Science

\`\`\`python
import numpy as np
import pandas as pd
from sklearn.model_selection import train_test_split
from sklearn.ensemble import RandomForestClassifier

# Load and prepare data
df = pd.read_csv('data.csv')
X = df.drop('target', axis=1)
y = df['target']

# Split data
X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, random_state=42
)

# Train model
model = RandomForestClassifier(n_estimators=100)
model.fit(X_train, y_train)

# Evaluate
accuracy = model.score(X_test, y_test)
print(f"Model accuracy: {accuracy:.2%}")
\`\`\`

### TypeScript - Generic Types

\`\`\`typescript
interface Repository<T> {
    find(id: string): Promise<T | null>;
    save(entity: T): Promise<T>;
    delete(id: string): Promise<boolean>;
}

class UserRepository implements Repository<User> {
    private users: Map<string, User> = new Map();
    
    async find(id: string): Promise<User | null> {
        return this.users.get(id) ?? null;
    }
    
    async save(user: User): Promise<User> {
        this.users.set(user.id, user);
        return user;
    }
    
    async delete(id: string): Promise<boolean> {
        return this.users.delete(id);
    }
}
\`\`\`

### Rust - Ownership

\`\`\`rust
fn main() {
    let s1 = String::from("hello");
    let s2 = s1.clone(); // Deep copy
    
    println!("s1 = {}, s2 = {}", s1, s2);
    
    // Ownership transfer
    let s3 = s1; // s1 is now invalid
    
    // Borrowing
    let len = calculate_length(&s3);
    println!("Length of '{}' is {}", s3, len);
}

fn calculate_length(s: &String) -> usize {
    s.len()
}
\`\`\`

### SQL - Complex Query

\`\`\`sql
WITH monthly_sales AS (
    SELECT 
        DATE_TRUNC('month', order_date) AS month,
        product_id,
        SUM(quantity * unit_price) AS revenue
    FROM orders
    WHERE order_date >= '2024-01-01'
    GROUP BY 1, 2
)
SELECT 
    p.name AS product_name,
    ms.month,
    ms.revenue,
    LAG(ms.revenue) OVER (
        PARTITION BY ms.product_id 
        ORDER BY ms.month
    ) AS prev_month_revenue,
    ROUND(
        (ms.revenue - LAG(ms.revenue) OVER (
            PARTITION BY ms.product_id 
            ORDER BY ms.month
        )) / LAG(ms.revenue) OVER (
            PARTITION BY ms.product_id 
            ORDER BY ms.month
        ) * 100, 2
    ) AS growth_percentage
FROM monthly_sales ms
JOIN products p ON p.id = ms.product_id
ORDER BY p.name, ms.month;
\`\`\`

### CSS - Modern Layout

\`\`\`css
.container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
    padding: clamp(1rem, 5vw, 3rem);
}

.card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 1rem;
    padding: 2rem;
    box-shadow: 
        0 10px 40px rgba(0, 0, 0, 0.1),
        0 2px 10px rgba(0, 0, 0, 0.05);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    
    &:hover {
        transform: translateY(-5px);
        box-shadow: 
            0 20px 60px rgba(0, 0, 0, 0.15),
            0 5px 20px rgba(0, 0, 0, 0.1);
    }
}
\`\`\`

---

## üìù Footnotes Example

The theory of relativity[^1] changed our understanding of space and time. Quantum mechanics[^2] describes the behavior of particles at the atomic scale. The Standard Model[^3] explains fundamental forces.

[^1]: Albert Einstein published his theory of special relativity in 1905.
[^2]: Developed in the early 20th century by Planck, Bohr, Heisenberg, and others.
[^3]: The Standard Model of particle physics was developed in the 1970s.

---

## üìä Tables

| Algorithm | Time Complexity | Space Complexity | Stable |
|-----------|-----------------|------------------|--------|
| Bubble Sort | O(n¬≤) | O(1) | ‚úÖ Yes |
| Quick Sort | O(n log n) | O(log n) | ‚ùå No |
| Merge Sort | O(n log n) | O(n) | ‚úÖ Yes |
| Heap Sort | O(n log n) | O(1) | ‚ùå No |

| Ÿà€å⁄ò⁄Ø€å | Ÿàÿ∂ÿπ€åÿ™ | ÿ™Ÿàÿ∂€åÿ≠ÿßÿ™ |
|-------|-------|---------|
| ŸÖÿßÿ±⁄©‚ÄåÿØÿßŸàŸÜ | ‚úÖ ŸÅÿπÿßŸÑ | Ÿæÿ¥ÿ™€åÿ®ÿßŸÜ€å ⁄©ÿßŸÖŸÑ |
| ÿ±€åÿßÿ∂€åÿßÿ™ | ‚úÖ ŸÅÿπÿßŸÑ | ÿ®ÿß ÿ±ŸÜ⁄Ø Ÿà ŸÅÿßÿ±ÿ≥€å |
| ⁄©ÿØ | ‚úÖ ŸÅÿπÿßŸÑ | +€≤€∞€∞ ÿ≤ÿ®ÿßŸÜ |

---

## üìå Lists

### Ordered List

1. First item
2. Second item
3. Third item with inline code \`example\`
4. Fourth item with math $x^2 + y^2 = z^2$

### Unordered List

- Item with **bold** text
- Item with *italic* text
- Item with \`code\`
- Item with [link](https://example.com)

### ŸÑ€åÿ≥ÿ™ ŸÅÿßÿ±ÿ≥€å

- ŸÖŸàÿ±ÿØ ÿßŸàŸÑ ÿ®ÿß **ŸÖÿ™ŸÜ Ÿæÿ±ÿ±ŸÜ⁄Ø**
- ŸÖŸàÿ±ÿØ ÿØŸàŸÖ ÿ®ÿß ŸÅÿ±ŸÖŸàŸÑ $a + b = c$
- ŸÖŸàÿ±ÿØ ÿ≥ŸàŸÖ ÿ®ÿß ⁄©ÿØ \`console.log()\`

---

## üí¨ Blockquotes

> "The only way to do great work is to love what you do."
> ‚Äî Steve Jobs

> üí° **Pro Tip:** Use \`\\text{ŸÅÿßÿ±ÿ≥€å}\` for Persian text inside math formulas!

> üìù **ŸÜ⁄©ÿ™Ÿá:** ÿ®ÿ±ÿß€å ŸÜŸàÿ¥ÿ™ŸÜ ŸÅÿßÿ±ÿ≥€å ÿØÿ± ŸÅÿ±ŸÖŸàŸÑ‚ÄåŸáÿß ÿßÿ≤ \`\\text{ŸÖÿ™ŸÜ ŸÅÿßÿ±ÿ≥€å}\` ÿßÿ≥ÿ™ŸÅÿßÿØŸá ⁄©ŸÜ€åÿØ!

---

## üîó Links & Images

Check out [GitHub](https://github.com) | [MDN Web Docs](https://developer.mozilla.org) | [Stack Overflow](https://stackoverflow.com)

---

## ‚ú® Mixed Content

This paragraph contains both English and ŸÅÿßÿ±ÿ≥€å text with inline math $\\alpha + \\beta = \\gamma$ and code \`function()\`.

ÿß€åŸÜ Ÿæÿßÿ±ÿß⁄Øÿ±ÿßŸÅ ÿ¥ÿßŸÖŸÑ ŸÖÿ™ŸÜ ŸÅÿßÿ±ÿ≥€å Ÿà English ÿ®ÿß ŸÅÿ±ŸÖŸàŸÑ ÿØÿ±ŸàŸÜ‚ÄåÿÆÿ∑€å $x = \\frac{-b}{2a}$ Ÿà ⁄©ÿØ \`npm install\` ÿßÿ≥ÿ™.

**Happy writing!** ‚ú® **ŸÜŸàÿ¥ÿ™ŸÜ ÿÆŸàÿ¥!** üéâ`;

        // Initialize with sample content
        markdownInput.value = sampleMarkdown;
        
        // Initial render after MathJax loads
        if (document.readyState === 'complete') {
            setTimeout(updatePreview, 500);
        } else {
            window.addEventListener('load', () => setTimeout(updatePreview, 500));
        }
    </script>
</body>
</html>
